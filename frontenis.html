<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torneo de Frontenis ISSEA</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-4 max-w-2xl mx-auto">
    <h1 class="text-2xl font-bold text-center mb-6">Administrador Torneo Frontenis ISSEA</h1>

    <section id="pairSection" class="mb-10">
        <h2 class="text-xl font-semibold mb-2">Agregar Pareja</h2>
        <form id="pairForm" class="grid grid-cols-1 gap-2 sm:grid-cols-3 sm:gap-4">
            <input id="zagueroName" placeholder="Zaguero" class="border p-2 rounded" />
            <input id="delanteroName" placeholder="Delantero" class="border p-2 rounded" />
            <button type="submit" class="bg-blue-500 text-white rounded p-2">Agregar</button>
        </form>
        <ul id="pairList" class="mt-4 space-y-1 text-sm"></ul>
    </section>

    <section id="matchSection" class="mb-10">
        <h2 class="text-xl font-semibold mb-2">Registrar Partido</h2>
        <form id="matchForm" class="grid grid-cols-2 gap-2 items-center">
            <select id="pairA" class="border p-2 rounded"></select>
            <input id="scoreA" type="number" min="0" class="border p-2 rounded" />
            <span class="col-span-2 text-center">vs</span>
            <select id="pairB" class="border p-2 rounded"></select>
            <input id="scoreB" type="number" min="0" class="border p-2 rounded" />
            <button type="submit" class="bg-green-600 text-white rounded p-2 col-span-2">Registrar</button>
        </form>
    </section>

    <section id="statsSection" class="mb-10">
        <h2 class="text-xl font-semibold mb-2">Estadísticas</h2>
        <div class="overflow-x-auto">
            <table class="min-w-full text-sm text-left">
                <thead>
                    <tr class="border-b">
                        <th class="px-2 py-1">Pareja</th>
                        <th class="px-2 py-1">JJ</th>
                        <th class="px-2 py-1">JG</th>
                        <th class="px-2 py-1">JP</th>
                        <th class="px-2 py-1">PF</th>
                        <th class="px-2 py-1">PC</th>
                    </tr>
                </thead>
                <tbody id="statsBody"></tbody>
            </table>
        </div>
    </section>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
import { getFirestore, collection, addDoc, getDocs, onSnapshot } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js';

// TODO: Reemplaza con la configuración de tu proyecto Firebase
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const pairForm = document.getElementById('pairForm');
const zagueroInput = document.getElementById('zagueroName');
const delanteroInput = document.getElementById('delanteroName');
const pairList = document.getElementById('pairList');
const pairASelect = document.getElementById('pairA');
const pairBSelect = document.getElementById('pairB');
const matchForm = document.getElementById('matchForm');
const statsBody = document.getElementById('statsBody');

pairForm.onsubmit = async e => {
    e.preventDefault();
    const zaguero = zagueroInput.value.trim();
    const delantero = delanteroInput.value.trim();
    if (!zaguero || !delantero) return;
    await addDoc(collection(db, 'pairs'), { zaguero, delantero });
    zagueroInput.value = '';
    delanteroInput.value = '';
};

matchForm.onsubmit = async e => {
    e.preventDefault();
    const pairA = pairASelect.value;
    const pairB = pairBSelect.value;
    const scoreA = parseInt(document.getElementById('scoreA').value) || 0;
    const scoreB = parseInt(document.getElementById('scoreB').value) || 0;
    if (!pairA || !pairB || pairA === pairB) return;
    await addDoc(collection(db, 'matches'), { pairA, pairB, scoreA, scoreB, ts: Date.now() });
    matchForm.reset();
};

function renderPairs(pairs) {
    pairList.innerHTML = '';
    pairASelect.innerHTML = '<option value="">Pareja A</option>';
    pairBSelect.innerHTML = '<option value="">Pareja B</option>';
    pairs.forEach(p => {
        const li = document.createElement('li');
        li.textContent = `${p.zaguero} / ${p.delantero}`;
        pairList.appendChild(li);

        const optA = document.createElement('option');
        optA.value = p.id;
        optA.textContent = `${p.zaguero} / ${p.delantero}`;
        pairASelect.appendChild(optA);
        const optB = optA.cloneNode(true);
        pairBSelect.appendChild(optB);
    });
}

function computeStats(pairs, matches) {
    const stats = {};
    pairs.forEach(p => stats[p.id] = { name: `${p.zaguero} / ${p.delantero}`, jj:0, jg:0, jp:0, pf:0, pc:0 });
    matches.forEach(m => {
        const a = stats[m.pairA];
        const b = stats[m.pairB];
        if (!a || !b) return;
        a.jj++; b.jj++;
        a.pf += m.scoreA; a.pc += m.scoreB;
        b.pf += m.scoreB; b.pc += m.scoreA;
        if (m.scoreA > m.scoreB) { a.jg++; b.jp++; }
        else if (m.scoreB > m.scoreA) { b.jg++; a.jp++; }
    });
    return Object.values(stats);
}

function renderStats(stats) {
    statsBody.innerHTML = '';
    stats.forEach(s => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="px-2 py-1">${s.name}</td><td>${s.jj}</td><td>${s.jg}</td><td>${s.jp}</td><td>${s.pf}</td><td>${s.pc}</td>`;
        statsBody.appendChild(tr);
    });
}

async function loadData() {
    const pairSnap = await getDocs(collection(db, 'pairs'));
    const pairs = pairSnap.docs.map(d => ({ id: d.id, ...d.data() }));
    const matchSnap = await getDocs(collection(db, 'matches'));
    const matches = matchSnap.docs.map(d => d.data());
    renderPairs(pairs);
    renderStats(computeStats(pairs, matches));
}

onSnapshot(collection(db, 'pairs'), loadData);
onSnapshot(collection(db, 'matches'), loadData);
loadData();
</script>
</body>
</html>
